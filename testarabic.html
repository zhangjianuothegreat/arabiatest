<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WelfareCalc.ch – حسابك</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://unpkg.com/jspdf@latest/dist/jspdf.umd.min.js"></script>
  <script src="https://unpkg.com/jspdf-autotable@3.5.31/dist/jspdf.plugin.autotable.min.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@400;700&display=swap');
    body { font-family: 'Noto Sans Arabic', 'Tahoma', sans-serif; }
  </style>
</head>

<body class="bg-gradient-to-br from-blue-50 to-green-50 min-h-screen font-sans text-right">
  <div class="container mx-auto p-6 max-w-4xl" dir="rtl">
    <div class="text-center mb-8">
      <h1 class="text-4xl font-bold text-green-700" data-i18n="calcTitle">حسابك</h1>
    </div>

    <!-- 输入表单 -->
    <div id="input-form" class="bg-white rounded-2xl shadow-xl p-8 mb-8"></div>

    <!-- 计算按钮 -->
    <button id="calc-btn" disabled
      class="w-full bg-gradient-to-r from-green-600 to-green-700 text-white py-4 rounded-xl font-bold text-xl mb-8 opacity-50 cursor-not-allowed">
      <span data-i18n="calcNow">احسب!</span>
    </button>

    <!-- 结果区 -->
    <div id="result" class="hidden">
      <div class="bg-green-50 rounded-2xl p-8 mb-6">
        <h2 class="text-3xl font-bold text-green-700 text-center mb-6">
          يمكنك الحصول على حوالي <span id="total-amount" class="text-5xl">0</span> فرنك سويسري/سنة!
        </h2>
        <div id="breakdown-list" class="space-y-6 mb-8"></div>
        <canvas id="chart" class="mx-auto max-w-md"></canvas>
      </div>

      <!-- 分享 & PDF -->
      <div class="text-center space-x-4">
        <button id="share-btn" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition">
          مشاركة & تنزيل PDF مجاناً
        </button>
        <button id="ad-btn" class="bg-orange-600 text-white px-6 py-3 rounded-lg hover:bg-orange-700 transition">
          مشاهدة الإعلان & PDF
        </button>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const { jsPDF } = window.jspdf;

      // === 1. URL 参数 ===
      const urlParams = new URLSearchParams(window.location.search);
      let canton = urlParams.get('c') || 'ZH';
      const situation = urlParams.get('s') || 'family';
      const lang = urlParams.get('lang') || 'ar';

      // === 2. 翻译 ===
      const t = {
        calcTitle: "حسابك",
        calcNow: "احسب!",
        total: "يمكنك الحصول على حوالي",
        year: "فرنك سويسري/سنة!",
        childFederal: "بدل العائلة الاتحادي",
        childBonus: "مكمل كانتوني",
        insuranceBase: "تخفيض قسط الأساس",
        insuranceChild: "مكمل الطفل",
        housingMonthly: "مساعدة السكن شهرياً",
        subtotal: "المجموع الفرعي",
        totalLabel: "المبلغ الإجمالي",
        negativeError: "لا يمكن أن يكون سلبياً!",
        plzError: "يجب أن يحتوي الرمز البريدي على 4 أرقام!",
        rentLabel: "الإيجار الشهري (فرنك سويسري)",
        premiumLabel: "قسط البالغ الشهري (فرنك سويسري لكل شخص)",
        kidsEducationLabel: "عدد الأطفال في التعليم (>16 عاماً)"
      };

      document.querySelector('[data-i18n="calcTitle"]').textContent = t.calcTitle;
      document.querySelector('[data-i18n="calcNow"]').textContent = t.calcNow;

      // === 3. 输入配置 ===
      const inputConfigs = {
        family: [
          { id: "income", label: "دخل الأسرة الشهري (فرنك سويسري)", type: "number", placeholder: "مثال 4000", min: 0 },
          { id: "kids", label: "عدد الأطفال (0–16 عاماً)", type: "number", placeholder: "مثال 2", min: 0 },
          { id: "kids_education", label: t.kidsEducationLabel, type: "number", placeholder: "مثال 0", min: 0 },
          { id: "plz", label: "الرمز البريدي", type: "text", placeholder: "مثال 8000" },
          { id: "rent", label: t.rentLabel, type: "number", placeholder: "مثال 1500", min: 0 },
          { id: "premium_adult", label: t.premiumLabel, type: "number", placeholder: "مثال 500", min: 0 }
        ]
      };

      // === 4. 渲染输入 ===
      function renderInputs() {
        const form = document.getElementById('input-form');
        form.innerHTML = inputConfigs.family.map(inp => `
          <div class="mb-6">
            <label for="${inp.id}" class="block text-lg font-semibold mb-2">${inp.label}</label>
            <input id="${inp.id}" type="${inp.type}" class="w-full p-3 border rounded-lg text-lg focus:ring-2 focus:ring-green-500 outline-none"
              placeholder="${inp.placeholder}" ${inp.min !== undefined ? `min="${inp.min}"` : ''}>
          </div>
        `).join('');

        document.getElementById('calc-btn').onclick = calculate;
        enableCalcButton();
      }

      // === 5. 联邦 & 州数据 (2025) - 完整26州 ===
      const federalData = {
        familienzulage_child: 215,
        familienzulage_education: 268
      };

      const cantonsData = {
        "AG": { familienzulagen_bonus: 0, praemien: { threshold_family: 65000, rate: 0.16, child_bonus_monthly: 108.33, ref_premium_adult_monthly: 456, max_reduction_monthly: 400 }, wohnbeihilfe: { max_housing_monthly_family: 1600, affordability_rate: 0.3 }, apply_links: { praemienverbilligung: "ag.ch/praemienverbilligung", wohnbeihilfe: "ag.ch/sozialhilfe" } },
        "AI": { familienzulagen_bonus: 30, praemien: { threshold_family: 70000, rate: 0.07, child_bonus_monthly: 100, ref_premium_adult_monthly: 456, max_reduction_monthly: 350 }, wohnbeihilfe: { max_housing_monthly_family: 1400, affordability_rate: 0.3 }, apply_links: { praemienverbilligung: "ai.ch/praemienverbilligung", wohnbeihilfe: "ai.ch/sozialhilfe" } },
        "AR": { familienzulagen_bonus: 15, praemien: { threshold_family: 46200, rate: 0.42, child_bonus_monthly: 104, ref_premium_adult_monthly: 456, max_reduction_monthly: 300 }, wohnbeihilfe: { max_housing_monthly_family: 1500, affordability_rate: 0.3 }, apply_links: { praemienverbilligung: "ar.ch/praemienverbilligung", wohnbeihilfe: "ar.ch/sozialhilfe" } },
        "BE": { familienzulagen_bonus: 35, praemien: { threshold_family: 65000, rate: 0.1, child_bonus_monthly: 211, ref_premium_adult_monthly: 456, max_reduction_monthly: 2529.6 / 12 }, wohnbeihilfe: { max_housing_monthly_family: 1550, affordability_rate: 0.3 }, apply_links: { praemienverbilligung: "be.ch/praemienverbilligung", wohnbeihilfe: "be.ch/sozialhilfe" } },
        "BL": { familienzulagen_bonus: 0, praemien: { threshold_family: 75000, rate: 0.0775, child_bonus_monthly: 108.33, ref_premium_adult_monthly: 456, max_reduction_monthly: 400 }, wohnbeihilfe: { max_housing_monthly_family: 1600, affordability_rate: 0.3 }, apply_links: { praemienverbilligung: "bl.ch/praemienverbilligung", wohnbeihilfe: "bl.ch/sozialhilfe" } },
        "BS": { familienzulagen_bonus: 60, praemien: { threshold_family: 107000, rate: 0.08, child_bonus_monthly: 271, ref_premium_adult_monthly: 456, max_reduction_monthly: 431 }, wohnbeihilfe: { max_housing_monthly_family: 1700, affordability_rate: 0.3 }, apply_links: { praemienverbilligung: "bs.ch/praemienverbilligung", wohnbeihilfe: "bs.ch/sozialhilfe" } },
        "FR": { familienzulagen_bonus: 50, praemien: { threshold_family: 65000, rate: 0.01, child_bonus_monthly: 125, ref_premium_adult_monthly: 456, max_reduction_monthly: 500 }, wohnbeihilfe: { max_housing_monthly_family: 1500, affordability_rate: 0.3 }, apply_links: { praemienverbilligung: "fr.ch/praemienverbilligung", wohnbeihilfe: "fr.ch/sozialhilfe" } },
        "GE": { familienzulagen_bonus: 96, praemien: { threshold_family: 115000, rate: 0.1, child_bonus_monthly: 200, ref_premium_adult_monthly: 456, max_reduction_monthly: 600 }, wohnbeihilfe: { max_housing_monthly_family: 1800, affordability_rate: 0.3 }, apply_links: { praemienverbilligung: "ge.ch/praemienverbilligung", wohnbeihilfe: "ge.ch/sozialhilfe" } },
        "GL": { familienzulagen_bonus: 0, praemien: { threshold_family: 100000, rate: 0.09, child_bonus_monthly: 108.33, ref_premium_adult_monthly: 456, max_reduction_monthly: 400 }, wohnbeihilfe: { max_housing_monthly_family: 1400, affordability_rate: 0.3 }, apply_links: { praemienverbilligung: "gl.ch/praemienverbilligung", wohnbeihilfe: "gl.ch/sozialhilfe" } },
        "GR": { familienzulagen_bonus: 15, praemien: { threshold_family: 60000, rate: 0.05, child_bonus_monthly: 108.33, ref_premium_adult_monthly: 456, max_reduction_monthly: 350 }, wohnbeihilfe: { max_housing_monthly_family: 1500, affordability_rate: 0.3 }, apply_links: { praemienverbilligung: "gr.ch/praemienverbilligung", wohnbeihilfe: "gr.ch/sozialhilfe" } },
        "JU": { familienzulagen_bonus: 60, praemien: { threshold_family: 53000, rate: 0.4, child_bonus_monthly: 100, ref_premium_adult_monthly: 456, max_reduction_monthly: 300 }, wohnbeihilfe: { max_housing_monthly_family: 1300, affordability_rate: 0.3 }, apply_links: { praemienverbilligung: "ju.ch/praemienverbilligung", wohnbeihilfe: "ju.ch/sozialhilfe" } },
        "LU": { familienzulagen_bonus: 45, praemien: { threshold_family: 70000, rate: 0.1, child_bonus_monthly: 108.33, ref_premium_adult_monthly: 456, max_reduction_monthly: 400 }, wohnbeihilfe: { max_housing_monthly_family: 1550, affordability_rate: 0.3 }, apply_links: { praemienverbilligung: "lu.ch/praemienverbilligung", wohnbeihilfe: "lu.ch/sozialhilfe" } },
        "NE": { familienzulagen_bonus: 25, praemien: { threshold_family: 50000, rate: 0.07, child_bonus_monthly: 100, ref_premium_adult_monthly: 456, max_reduction_monthly: 350 }, wohnbeihilfe: { max_housing_monthly_family: 1400, affordability_rate: 0.3 }, apply_links: { praemienverbilligung: "ne.ch/praemienverbilligung", wohnbeihilfe: "ne.ch/sozialhilfe" } },
        "NW": { familienzulagen_bonus: 43, praemien: { threshold_family: 60000, rate: 0.1, child_bonus_monthly: 108.33, ref_premium_adult_monthly: 456, max_reduction_monthly: 300 }, wohnbeihilfe: { max_housing_monthly_family: 1300, affordability_rate: 0.3 }, apply_links: { praemienverbilligung: "nw.ch/praemienverbilligung", wohnbeihilfe: "nw.ch/sozialhilfe" } },
        "OW": { familienzulagen_bonus: 5, praemien: { threshold_family: 70000, rate: 0.1, child_bonus_monthly: 108.33, ref_premium_adult_monthly: 456, max_reduction_monthly: 350 }, wohnbeihilfe: { max_housing_monthly_family: 1400, affordability_rate: 0.3 }, apply_links: { praemienverbilligung: "ow.ch/praemienverbilligung", wohnbeihilfe: "ow.ch/sozialhilfe" } },
        "SG": { familienzulagen_bonus: 30, praemien: { threshold_family: 60500, rate: 0.1135, child_bonus_monthly: 100, ref_premium_adult_monthly: 456, max_reduction_monthly: 400 }, wohnbeihilfe: { max_housing_monthly_family: 1550, affordability_rate: 0.3 }, apply_links: { praemienverbilligung: "sg.ch/praemienverbilligung", wohnbeihilfe: "sg.ch/sozialhilfe" } },
        "SH": { familienzulagen_bonus: 30, praemien: { threshold_family: 65000, rate: 0.15, child_bonus_monthly: 108.33, ref_premium_adult_monthly: 456, max_reduction_monthly: 400 }, wohnbeihilfe: { max_housing_monthly_family: 1600, affordability_rate: 0.3 }, apply_links: { praemienverbilligung: "sh.ch/praemienverbilligung", wohnbeihilfe: "sh.ch/sozialhilfe" } },
        "SO": { familienzulagen_bonus: 0, praemien: { threshold_family: 100000, rate: 0.09, child_bonus_monthly: 108.33, ref_premium_adult_monthly: 456, max_reduction_monthly: 400 }, wohnbeihilfe: { max_housing_monthly_family: 1500, affordability_rate: 0.3 }, apply_links: { praemienverbilligung: "so.ch/praemienverbilligung", wohnbeihilfe: "so.ch/sozialhilfe" } },
        "SZ": { familienzulagen_bonus: 15, praemien: { threshold_family: 43014, rate: 0.11, child_bonus_monthly: 200, ref_premium_adult_monthly: 456, max_reduction_monthly: 200 }, wohnbeihilfe: { max_housing_monthly_family: 1550, affordability_rate: 0.3 }, apply_links: { praemienverbilligung: "sz.ch/praemienverbilligung", wohnbeihilfe: "sz.ch/sozialhilfe" } },
        "TG": { familienzulagen_bonus: 0, praemien: { threshold_family: 70000, rate: 0.1, child_bonus_monthly: 100, ref_premium_adult_monthly: 456, max_reduction_monthly: 3396 / 12 }, wohnbeihilfe: { max_housing_monthly_family: 1500, affordability_rate: 0.3 }, apply_links: { praemienverbilligung: "tg.ch/praemienverbilligung", wohnbeihilfe: "tg.ch/sozialhilfe" } },
        "TI": { familienzulagen_bonus: 0, praemien: { threshold_family: 51560, rate: 0.1, child_bonus_monthly: 489.5, ref_premium_adult_monthly: 456, max_reduction_monthly: 489.5 }, wohnbeihilfe: { max_housing_monthly_family: 1600, affordability_rate: 0.3 }, apply_links: { praemienverbilligung: "ti.ch/praemienverbilligung", wohnbeihilfe: "ti.ch/sozialhilfe" } },
        "UR": { familienzulagen_bonus: 25, praemien: { threshold_family: 70000, rate: 0.0975, child_bonus_monthly: 108.33, ref_premium_adult_monthly: 456, max_reduction_monthly: 350 }, wohnbeihilfe: { max_housing_monthly_family: 1400, affordability_rate: 0.3 }, apply_links: { praemienverbilligung: "ur.ch/praemienverbilligung", wohnbeihilfe: "ur.ch/sozialhilfe" } },
        "VD": { familienzulagen_bonus: 107, praemien: { threshold_family: 72500, rate: 0.08, child_bonus_monthly: 28, ref_premium_adult_monthly: 456, max_reduction_monthly: 28 }, wohnbeihilfe: { max_housing_monthly_family: 1700, affordability_rate: 0.3 }, apply_links: { praemienverbilligung: "vd.ch/praemienverbilligung", wohnbeihilfe: "vd.ch/sozialhilfe" } },
        "VS": { familienzulagen_bonus: 112, praemien: { threshold_family: 36750, rate: 0.07, child_bonus_monthly: 100, ref_premium_adult_monthly: 456, max_reduction_monthly: 400 }, wohnbeihilfe: { max_housing_monthly_family: 1600, affordability_rate: 0.3 }, apply_links: { praemienverbilligung: "vs.ch/praemienverbilligung", wohnbeihilfe: "vs.ch/sozialhilfe" } },
        "ZG": { familienzulagen_bonus: 115, praemien: { threshold_family: 90000, rate: 0.08, child_bonus_monthly: 108.33, ref_premium_adult_monthly: 456, max_reduction_monthly: 400 }, wohnbeihilfe: { max_housing_monthly_family: 1800, affordability_rate: 0.3 }, apply_links: { praemienverbilligung: "zg.ch/praemienverbilligung", wohnbeihilfe: "zg.ch/sozialhilfe" } },
        "ZH": { familienzulagen_bonus: 0, praemien: { threshold_family: 88580, rate: 0.1, child_bonus_monthly: 150, ref_premium_adult_monthly: 456, max_reduction_monthly: 400 }, wohnbeihilfe: { max_housing_monthly_family: 1700, affordability_rate: 0.3 }, apply_links: { praemienverbilligung: "svazurich.ch/praemienverbilligung", wohnbeihilfe: "zh.ch/sozialhilfe" } }
      };

      // === 6. 启用计算按钮 ===
      function enableCalcButton() {
        const inputs = document.querySelectorAll('#input-form input');
        const btn = document.getElementById('calc-btn');
        inputs.forEach(input => input.addEventListener('input', () => {
          const allFilled = Array.from(inputs).every(i => i.value.trim() !== '');
          btn.disabled = !allFilled;
          btn.classList.toggle('opacity-50', !allFilled);
          btn.classList.toggle('cursor-not-allowed', !allFilled);
        }));
      }

      // === 7. 计算函数 ===
      let total = 0;
      let breakdown = {};
      let inputs = {};
      window.calculate = function () {
        inputs = {
          income: +document.getElementById('income').value,
          kids: +document.getElementById('kids').value,
          kids_education: +document.getElementById('kids_education').value,
          plz: document.getElementById('plz').value,
          rent: +document.getElementById('rent').value,
          premium_adult: +document.getElementById('premium_adult').value
        };

        if (inputs.plz.length !== 4 || isNaN(+inputs.plz)) {
          alert(t.plzError); return;
        }

        const cantonData = cantonsData[canton] || cantonsData["ZH"];
        const p = cantonData.praemien;
        const w = cantonData.wohnbeihilfe;

        // 家庭津贴
        const family = ((federalData.familienzulage_child + cantonData.familienzulagen_bonus) * inputs.kids + federalData.familienzulage_education * inputs.kids_education) * 12;

        // 保险费减免
        const children = inputs.kids + inputs.kids_education;
        const calc = p.ref_premium_adult_monthly - (inputs.income * p.rate) + (p.child_bonus_monthly * children);
        const premium = Math.max(0, Math.min(calc, p.max_reduction_monthly)) * 12;

        // 住房补助
        const cappedRent = Math.min(inputs.rent, w.max_housing_monthly_family);
        const housingMonthly = Math.max(0, cappedRent - (inputs.income * w.affordability_rate));
        const housing = housingMonthly * 12;

        breakdown = { 'Family Allowance': family, 'Premium Reduction': premium, 'Housing Assistance': housing };
        total = family + premium + housing;

        document.getElementById('total-amount').textContent = Math.round(total).toLocaleString();
        document.getElementById('result').classList.remove('hidden');

        renderBreakdown();
        renderChart();
      };

      function renderBreakdown() {
        const list = document.getElementById('breakdown-list');
        list.innerHTML = Object.entries(breakdown)
          .filter(([_, v]) => v > 0)
          .map(([k, v]) => `<div class="text-lg"><strong>${k}</strong>: ${v.toLocaleString()} فرنك/سنة</div>`)
          .join('');
      }

      function renderChart() {
        const ctx = document.getElementById('chart').getContext('2d');
        new Chart(ctx, {
          type: 'doughnut',
          data: {
            labels: Object.keys(breakdown).filter(k => breakdown[k] > 0),
            datasets: [{ data: Object.values(breakdown).filter(v => v > 0), backgroundColor: ['#10b981', '#3b82f6', '#f59e0b'] }]
          },
          options: { plugins: { legend: { position: 'bottom' } } }
        });
      }

      // === 8. PDF 生成 ===
      window.generatePDF = function () {
        const doc = new jsPDF({ orientation: 'portrait', unit: 'mm', format: 'a4' });
        const cantonData = cantonsData[canton] || cantonsData["ZH"];

        doc.setFont('helvetica', 'bold');
        doc.setFontSize(16);
        doc.text("WelfareCalc.ch – تقرير المساعدات الاجتماعية (2025)", 105, 20, { align: 'center' });

        doc.setFontSize(11);
        doc.text(`الكانتون: ${canton} | الرمز البريدي: ${inputs.plz} | التاريخ: ${new Date().toLocaleDateString('ar-CH')}`, 195, 35, { align: 'right' });

        doc.setFontSize(14);
        doc.setTextColor(22, 163, 74);
        doc.text(`${t.totalLabel}: ${Math.round(total).toLocaleString()} فرنك/سنة`, 195, 50, { align: 'right' });
        doc.setTextColor(0);

        const tableData = Object.entries(breakdown)
          .filter(([_, v]) => v > 0)
          .map(([name, amount]) => {
            let formula = '';
            if (name === 'Family Allowance') {
              formula = `((215 + ${cantonData.familienzulagen_bonus}) × ${inputs.kids} + 268 × ${inputs.kids_education}) × 12`;
            } else if (name === 'Premium Reduction') {
              const calc = cantonData.praemien.ref_premium_adult_monthly - (inputs.income * cantonData.praemien.rate) + (cantonData.praemien.child_bonus_monthly * (inputs.kids + inputs.kids_education));
              formula = `max(0, min(${calc.toFixed(1)}, ${cantonData.praemien.max_reduction_monthly})) × 12`;
            } else if (name === 'Housing Assistance') {
              const capped = Math.min(inputs.rent, cantonData.wohnbeihilfe.max_housing_monthly_family);
              formula = `max(0, ${capped} - ${inputs.income} × 0.3) × 12`;
            }
            return [name === 'Family Allowance' ? 'بدل العائلة' : name === 'Premium Reduction' ? 'تخفيض القسط' : 'مساعدة السكن', `${amount.toLocaleString()} فرنك/سنة`, formula];
          });

        doc.autoTable({
          head: [['البند', 'المبلغ', 'الصيغة']],
          body: tableData,
          startY: 60,
          styles: { font: 'helvetica', fontSize: 10, halign: 'right', cellPadding: 3 },
          headStyles: { fillColor: [34, 139, 34], textColor: 255 },
          alternateRowStyles: { fillColor: [240, 253, 244] },
          columnStyles: { 0: { fontStyle: 'bold' } }
        });

        let y = doc.lastAutoTable.finalY + 10;
        doc.setFontSize(12);
        doc.text("كيفية التقديم:", 195, y, { align: 'right' }); y += 7;
        doc.setFontSize(10);
        if (breakdown['Family Allowance'] > 0) {
          doc.text(`• بدل العائلة: easygov.swiss/ar/familienzulage`, 195, y, { align: 'right' }); y += 6;
        }
        if (breakdown['Premium Reduction'] > 0) {
          doc.text(`• تخفيض القسط: ${cantonData.apply_links.praemienverbilligung}`, 195, y, { align: 'right' }); y += 6;
        }
        if (breakdown['Housing Assistance'] > 0) {
          doc.text(`• مساعدة السكن: ${cantonData.apply_links.wohnbeihilfe}`, 195, y, { align: 'right' }); y += 6;
        }

        doc.save(`WelfareCalc-${canton}-${new Date().toISOString().slice(0,10)}.pdf`);
      };

      // === 9. 分享 & 广告 ===
      window.shareToUnlock = function () {
        if (!total) return alert("احسب أولاً!");
        if (navigator.share) {
          navigator.share({ title: 'WelfareCalc.ch', text: `اكتشفت ${Math.round(total).toLocaleString()} فرنك!`, url: location.href })
            .then(() => setTimeout(generatePDF, 1000));
        } else generatePDF();
      };

      window.showAdThenPDF = function () {
        if (!total) return alert("احسب أولاً!");
        const overlay = document.createElement('div');
        overlay.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50';
        overlay.innerHTML = `<div class="bg-white p-8 rounded-xl text-center max-w-sm w-full mx-4">
          <h3 class="text-xl font-bold mb-4">إعلان (5 ثوان)</h3>
          <div class="bg-gray-200 border-2 border-dashed rounded-xl w-full h-40 mb-6"></div>
          <p class="text-sm">قابل للإغلاق خلال <span id="countdown" class="font-bold text-orange-600">5</span> ثوان</p>
        </div>`;
        document.body.appendChild(overlay);
        let sec = 5;
        const el = overlay.querySelector('#countdown');
        const timer = setInterval(() => {
          sec--;
          el.textContent = sec;
          if (sec <= 0) { clearInterval(timer); overlay.remove(); generatePDF(); }
        }, 1000);
      };

      // === 10. 初始化 ===
      renderInputs();
      document.getElementById('share-btn').onclick = shareToUnlock;
      document.getElementById('ad-btn').onclick = showAdThenPDF;
    });
  </script>
</body>

</html>
